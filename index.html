<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script src="https://www.googleoptimize.com/optimize.js?id=OPT-K623PPQ"></script>
<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。">
<meta name="keywords" content="JavaScript,Angular,python3,RxJS,nodejs,linux,css,nginx">
<meta property="og:type" content="website">
<meta property="og:title" content="挽留之王小石">
<meta property="og:url" content="http:&#x2F;&#x2F;blog.juphy.cn&#x2F;index.html">
<meta property="og:site_name" content="挽留之王小石">
<meta property="og:description" content="挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://blog.juphy.cn/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>挽留之王小石</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="挽留之王小石" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">挽留之王小石</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Hello,world!</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.juphy.cn/blogs/942c420c.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Juphy">
      <meta itemprop="description" content="挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="挽留之王小石">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blogs/942c420c.html" class="post-title-link" itemprop="url">URL编码</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-10 14:56:00" itemprop="dateCreated datePublished" datetime="2018-09-10T14:56:00+08:00">2018-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-09-13 14:21:33" itemprop="dateModified" datetime="2018-09-13T14:21:33+08:00">2018-09-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p>一般来说，URL只能使用英文字母、阿拉伯数字和某些标点符号，不能使用其他文字和符号。</p>
<blockquote>
<p>只有字母和数字[0-9a-zA-Z]、一些特殊符号”$-_.+!*’(),”[不包括双引号]、以及某些保留字，才可以不经过编码直接用于URL。</p>
</blockquote>
<h2 id="URL编码"><a href="#URL编码" class="headerlink" title="URL编码"></a>URL编码</h2><h3 id="网址路径"><a href="#网址路径" class="headerlink" title="网址路径"></a>网址路径</h3><p><code>http://zh.wikipedia.org/wiki/春节</code>的实际地址是<code>https://zh.wikipedia.org/wiki/%E6%98%A5%E8%8A%82</code>。</p>
<p>“春”和”节”的utf-8编码分别是”E6 98 A5”和”E8 8A 82”，因此，”%E6%98%A5%E8%8A%82”就是按照顺序，在每个字节前加上%而得到的。</p>
<blockquote>
<p>网址路径的编码，用的是utf-8编码</p>
</blockquote>
<h3 id="查询字符串"><a href="#查询字符串" class="headerlink" title="查询字符串"></a>查询字符串</h3><p><code>http://www.baidu.com/s?wd=春节</code>，各浏览器编码不一致，用的是操作系统的默认编码。</p>
<h3 id="GET方法生成的URL"><a href="#GET方法生成的URL" class="headerlink" title="GET方法生成的URL"></a>GET方法生成的URL</h3><p>在已打开的网页上，直接用Get或Post方法发出HTTP请求。</p>
<blockquote>
<p>GET和POST方法的编码，用的是网页的编码</p>
</blockquote>
<h3 id="Ajax调用的URL"><a href="#Ajax调用的URL" class="headerlink" title="Ajax调用的URL"></a>Ajax调用的URL</h3><p>在Ajax调用中，IE总是采用GB2312编码（操作系统的默认编码），而Firefox总是采用utf-8编码。</p>
<h2 id="escape"><a href="#escape" class="headerlink" title="escape()"></a>escape()</h2><p>现在已经不再使用了。</p>
<p>除了ASCII字母、数字、标点符号”@ * _ + - . /“以外，对其他所有字符进行编码。返回一个字符的Unicode编码值，在\u0000到\u00ff之间的符号被转成%xx的形式，其余符号被转成%uxxxx的形式。对应的解码函数是unescape()。</p>
<p>escape()不对”+”编码。网页在提交表单的时候，如果有空格，则会被转化为+字符。服务器处理数据的时候，会把+号处理成空格。</p>
<h2 id="encodeURI"><a href="#encodeURI" class="headerlink" title="encodeURI()"></a>encodeURI()</h2><p>它着眼于对整个URL进行编码，因此除了常见的符号以外，对其他一些在网址中有特殊含义的符号”; / ? : @ &amp; = + $ , #”，也不进行编码。编码后，它输出符号的utf-8形式，并且在每个字节前加上%。</p>
<p>解码函数是decodeURI()。</p>
<p>不对单引号’编码。</p>
<h2 id="encodeURIComponent"><a href="#encodeURIComponent" class="headerlink" title="encodeURIComponent()"></a>encodeURIComponent()</h2><p>用于对URL的组成部分进行个别编码，而不用于对整个URL进行编码。因此，”; / ? : @ &amp; = + $ , #”，这些在encodeURI()中不被编码的符号，在encodeURIComponent()中统统会被编码。至于具体的编码方法，两者是一样。</p>
<p>解码函数是decodeURIComponent()。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.juphy.cn/blogs/5adc8916.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Juphy">
      <meta itemprop="description" content="挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="挽留之王小石">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blogs/5adc8916.html" class="post-title-link" itemprop="url">Angular中的ng-content使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-07 14:56:00" itemprop="dateCreated datePublished" datetime="2018-09-07T14:56:00+08:00">2018-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-09-13 13:39:53" itemprop="dateModified" datetime="2018-09-13T13:39:53+08:00">2018-09-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2><p>当复用一个组件时，大部分的内容是相同的，只有一部分的内容是不同的，这时可以使用<code>ng-content</code>指令来提高组件的复用性。<br>内容投影，即通过使用<ng-content>指令来实现内容投影的功能。</p>
<p>以下User的定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">User定义内容：</span><br><span class="line">export interface User &#123;</span><br><span class="line">  email: string;</span><br><span class="line">  password: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义一个ChildComponent组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, Output, EventEmitter &#125; from &quot;@angular/core&quot;;</span><br><span class="line"></span><br><span class="line">import &#123; User &#125; from &quot;./auth-form.interface&quot;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &quot;app-child&quot;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;form (ngSubmit)=&quot;onSubmit(form.value)&quot; #form=&quot;ngForm&quot;&gt;</span><br><span class="line">        &lt;ng-content&gt;&lt;/ng-content&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          邮箱</span><br><span class="line">          &lt;input type=&quot;email&quot; name=&quot;email&quot; ngModel&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          密码</span><br><span class="line">          &lt;input type=&quot;password&quot; name=&quot;password&quot; ngModel&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">        &lt;button type=&quot;submit&quot;&gt;</span><br><span class="line">          提交</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  `</span><br><span class="line">&#125;)</span><br><span class="line">export class ChildComponent &#123;</span><br><span class="line">  @Output() submitted: EventEmitter&lt;User&gt; = new EventEmitter&lt;User&gt;();</span><br><span class="line"></span><br><span class="line">  onSubmit(value: User) &#123;</span><br><span class="line">    this.submitted.emit(value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在ParentComponent组件中，使用已经定义的ChildComponent组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &quot;@angular/core&quot;;</span><br><span class="line"></span><br><span class="line">import &#123; User &#125; from &quot;./auth-form/auth-form.interface&quot;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &quot;app-parent&quot;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;app-child </span><br><span class="line">        (submitted)=&quot;createUser($event)&quot;&gt;</span><br><span class="line">        &lt;h3&gt;注册&lt;/h3&gt;</span><br><span class="line">        &lt;button type=&quot;submit&quot;&gt;</span><br><span class="line">            注册</span><br><span class="line">        &lt;/button&gt;  </span><br><span class="line">      &lt;/app-child&gt;</span><br><span class="line">      &lt;app-child </span><br><span class="line">        (submitted)=&quot;loginUser($event)&quot;&gt;</span><br><span class="line">        &lt;h3&gt;登录&lt;/h3&gt;</span><br><span class="line">        &lt;button type=&quot;submit&quot;&gt;</span><br><span class="line">        登录</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/app-child&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  `</span><br><span class="line">&#125;)</span><br><span class="line">export class ParentComponent &#123;</span><br><span class="line">  createUser(user: User) &#123;</span><br><span class="line">    console.log(&quot;Create account&quot;, user);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  loginUser(user: User) &#123;</span><br><span class="line">    console.log(&quot;Login&quot;, user);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在app-parent中app-child标签内的多余的html会被投影到ChildComponent组件的’ng-content’中。</p>
<h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><p>select属性支持CSS选择器（element，class，attribute[name=xxx]）来匹配所需要的内容。如果ng-content上没有设置select属性，他将接收全部内容，或接收不匹配的任何其他的ng-content元素的内容。如果有多个相同element，class等都会被ng-content投影。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;form #form=&quot;ngForm&quot; (ngSubmit)=&quot;onSubmit(form.value)&quot; novalidate&gt;</span><br><span class="line">    &lt;ng-content select=&quot;h3&quot;&gt;&lt;/ng-content&gt;</span><br><span class="line">    &lt;label&gt;</span><br><span class="line">      邮箱</span><br><span class="line">      &lt;input type=&quot;email&quot; name=&quot;email&quot; ngModel&gt;</span><br><span class="line">    &lt;/label&gt;</span><br><span class="line">    &lt;label&gt;</span><br><span class="line">      密码</span><br><span class="line">      &lt;input type=&quot;password&quot; name=&quot;password&quot; ngModel&gt;</span><br><span class="line">    &lt;/label&gt;</span><br><span class="line">    &lt;ng-content select=&quot;app-auth-remember&quot;&gt;&lt;/ng-content&gt;</span><br><span class="line">    &lt;ng-content select=&quot;button&quot;&gt;&lt;/ng-content&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// app-auth-remember组件内容</span><br><span class="line"></span><br><span class="line">import &#123;Component, OnInit, Output, EventEmitter&#125; from &apos;@angular/core&apos;;</span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;app-auth-remember&apos;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;label&gt;</span><br><span class="line">      &lt;input type=&quot;checkbox&quot; (change)=&quot;onChecked($event.target.checked)&quot;&gt;</span><br><span class="line">      Keep me logged in</span><br><span class="line">    &lt;/label&gt;</span><br><span class="line">  `,</span><br><span class="line">  styleUrls: [&apos;./auth-remember.component.css&apos;]</span><br><span class="line">&#125;)</span><br><span class="line">export class AuthRememberComponent implements OnInit &#123;</span><br><span class="line">  @Output() checked: EventEmitter&lt;boolean&gt; = new EventEmitter&lt;boolean&gt;();</span><br><span class="line"></span><br><span class="line">  constructor() &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    console.log(&apos;初始化已完成！&apos;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onChecked(value: boolean) &#123;</span><br><span class="line">    this.checked.emit(value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>app-child的组件中ng-content的select属性分别对应h3和button，也就是分别映射h3标签和button标签。如果有多个ng-content标签都没有select属性，则默认最后一个ng-content匹配所有的标签。</p>
<p><code>warning</code>：如果想要正确根据select属性投射内容，限制就是这些标签必须是组件标签的直接子节点。<br>如果不是直接子节点，将不会被匹配到，如果要解决这个问题就必须在需要被匹配到的标签上，加上属性<code>ngProjectAs=&quot;xxx&quot;</code>，就可以通过<code>select=&quot;xxx&quot;</code>进行投影。</p>
<h3 id="组件投影"><a href="#组件投影" class="headerlink" title="组件投影"></a>组件投影</h3><p>组件必须在带有ng-content的组件标签内，这样<code>ng-content</code>才能匹配到组件。当然这样操作会对性能有一定的影响，因为<code>ng-content</code>不会产生内容，他只是投影现有的内容，因此这些组件一开始已经被制造，投影内容的生命周期将被绑定到他被声明的地方，而不是在显示的地方。</p>
<p>child-component</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">    selector: &apos;demo-child-component&apos;,</span><br><span class="line">    template: &apos;&lt;h3&gt;我是child-component组件&lt;/h3&gt;&apos;</span><br><span class="line">&#125;)</span><br><span class="line">export class ChildComponent implements OnInit &#123;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ngOnInit() &#123;</span><br><span class="line">        console.log(&apos;child-component初始化完成！&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>parent-component</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">    selector: &apos;parent-component&apos;,</span><br><span class="line">    template: `</span><br><span class="line">        &lt;button (click)=&quot;show = !show&quot;&gt;</span><br><span class="line">            &#123;&#123; show ? &apos;Hide&apos; : &apos;Show&apos; &#125;&#125;</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">        &lt;div class=&quot;content&quot; *ngIf=&quot;show&quot;&gt;</span><br><span class="line">            &lt;ng-content&gt;&lt;/ng-content&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    `</span><br><span class="line">&#125;)</span><br><span class="line">export class ParentComponent implements OnInit &#123;</span><br><span class="line">    show = true;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ngOnInit() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后将child-component投射到parent-component中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent-component&gt;</span><br><span class="line">    &lt;child-component&gt;&lt;/child-component&gt;</span><br><span class="line">&lt;/parent-component&gt;</span><br></pre></td></tr></table></figure>
<p>在控制台只能看到一次’child-component初始化完成！’，点击按钮切换，不在打印，说明该组件只被实例化了一次——未被销毁和重新创建。当然可以在parent-component标签中对要投影的组件进行控制。</p>
<h2 id="ContentChild"><a href="#ContentChild" class="headerlink" title="ContentChild"></a>ContentChild</h2><p>获取ng-content投射组件的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;</span><br><span class="line">   selector: &quot;app-child&quot;,</span><br><span class="line">   template: `</span><br><span class="line">     &lt;div&gt;</span><br><span class="line">       &lt;form (ngSubmit)=&quot;onSubmit(form.value)&quot; #form=&quot;ngForm&quot;&gt;</span><br><span class="line">         &lt;ng-content select=&quot;h3&quot;&gt;&lt;/ng-content&gt;</span><br><span class="line">         &lt;label&gt;</span><br><span class="line">           Email address</span><br><span class="line">           &lt;input type=&quot;email&quot; name=&quot;email&quot; ngModel&gt;</span><br><span class="line">         &lt;/label&gt;</span><br><span class="line">         &lt;label&gt;</span><br><span class="line">           Password</span><br><span class="line">           &lt;input type=&quot;password&quot; name=&quot;password&quot; ngModel&gt;</span><br><span class="line">         &lt;/label&gt;</span><br><span class="line">         &lt;ng-content select=&quot;app-auth-remember&quot;&gt;&lt;/ng-content&gt;</span><br><span class="line">         &lt;div *ngIf=&quot;showMessage&quot;&gt;</span><br><span class="line">           保持登录状态30天</span><br><span class="line">         &lt;/div&gt;</span><br><span class="line">         &lt;ng-content select=&quot;button&quot;&gt;&lt;/ng-content&gt;</span><br><span class="line">       &lt;/form&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">   `</span><br><span class="line"> &#125;)</span><br><span class="line"> export class AuthFormComponent implements AfterContentInit &#123;</span><br><span class="line">   showMessage: boolean;</span><br><span class="line"></span><br><span class="line">   @ContentChild(AuthRememberComponent) remember: AuthRememberComponent;</span><br><span class="line"></span><br><span class="line">   ngAfterContentInit() &#123;</span><br><span class="line">     if (this.remember) &#123;</span><br><span class="line">        // 因为在app-auth-remember组件已经将值checked进行EventEmitter处理且进行了emit，故而这里可以动态的获取值。</span><br><span class="line">       this.remember.checked.subscribe(</span><br><span class="line">         (checked: boolean) =&gt; (this.showMessage = checked)</span><br><span class="line">       );</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   // ...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>通过 ContentChild(AuthRememberComponent) 来设置获取的组件类型，此外我们在生命周期钩子 ngAfterContentInit 中通过订阅 remember 的 checked 输出属性来监听 checkbox 输入框的变化。</p>
<h2 id="ContentChildren"><a href="#ContentChildren" class="headerlink" title="ContentChildren"></a>ContentChildren</h2><p>与ContentChild类似通过Content Projection方式设置的视图中获取匹配的多个元素，返回的结果是一个QueryList集合。</p>
<p>在parent-component中添加多个app-auth-remember：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;</span><br><span class="line">  selector: &quot;app-parent&quot;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;app-child</span><br><span class="line">        (submitted)=&quot;createUser($event)&quot;&gt;</span><br><span class="line">        &lt;h3&gt;注册&lt;/h3&gt;</span><br><span class="line">        &lt;button type=&quot;submit&quot;&gt;</span><br><span class="line">          注册</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/app-child&gt;</span><br><span class="line">      &lt;app-child</span><br><span class="line">        (submitted)=&quot;loginUser($event)&quot;&gt;</span><br><span class="line">        &lt;h3&gt;登录&lt;/h3&gt;</span><br><span class="line">        &lt;app-auth-remember (checked)=&quot;rememberUser($event)&quot;&gt;&lt;/app-auth-remember&gt;</span><br><span class="line">        &lt;app-auth-remember (checked)=&quot;rememberUser($event)&quot;&gt;&lt;/app-auth-remember&gt;</span><br><span class="line">        &lt;app-auth-remember (checked)=&quot;rememberUser($event)&quot;&gt;&lt;/app-auth-remember&gt;</span><br><span class="line">        &lt;button type=&quot;submit&quot;&gt;</span><br><span class="line">          登录</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/app-child&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  `</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在ChildComponent中引入ContentChildren装饰器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, Output, EventEmitter, ContentChildren, QueryList, AfterContentInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; AuthRememberComponent &#125; from &apos;./auth-remember.component&apos;;</span><br><span class="line">import &#123; User &#125; from &apos;./auth-form.interface&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;app-child&apos;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;form (ngSubmit)=&quot;onSubmit(form.value)&quot; #form=&quot;ngForm&quot;&gt;</span><br><span class="line">        &lt;ng-content select=&quot;h3&quot;&gt;&lt;/ng-content&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          邮箱</span><br><span class="line">          &lt;input type=&quot;email&quot; name=&quot;email&quot; ngModel&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          密码</span><br><span class="line">          &lt;input type=&quot;password&quot; name=&quot;password&quot; ngModel&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">        &lt;ng-content select=&quot;app-auth-remember&quot;&gt;&lt;/ng-content&gt;</span><br><span class="line">        &lt;div *ngIf=&quot;showMessage&quot;&gt;</span><br><span class="line">          保持登录30天</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;ng-content select=&quot;button&quot;&gt;&lt;/ng-content&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  `</span><br><span class="line">&#125;)</span><br><span class="line">export class AuthFormComponent implements AfterContentInit &#123;</span><br><span class="line"></span><br><span class="line">  showMessage: boolean;</span><br><span class="line"></span><br><span class="line">  @ContentChildren(AuthRememberComponent) remember: QueryList&lt;AuthRememberComponent&gt;;</span><br><span class="line"></span><br><span class="line">  @Output() submitted: EventEmitter&lt;User&gt; = new EventEmitter&lt;User&gt;();</span><br><span class="line"></span><br><span class="line">  ngAfterContentInit() &#123;</span><br><span class="line">    if (this.remember) &#123;</span><br><span class="line">      this.remember.forEach((item) =&gt; &#123;</span><br><span class="line">        item.checked.subscribe((checked: boolean) =&gt; this.showMessage = checked);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ContentChildren 装饰器返回的是一个 QueryList 集合，在 ngAfterContentInit 生命周期钩子中，我们通过 QueryList 实例提供的 forEach 方法来遍历集合中的元素。QueryList 实例除了提供 forEach() 方法之外，它还提供了数组常用的方法，比如 map()、filter()、find()、some() 和 reduce() 等方法。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.juphy.cn/blogs/5f94f955.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Juphy">
      <meta itemprop="description" content="挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="挽留之王小石">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blogs/5f94f955.html" class="post-title-link" itemprop="url">Angular中的http请求</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-05 14:56:00" itemprop="dateCreated datePublished" datetime="2018-09-05T14:56:00+08:00">2018-09-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-09-06 11:06:43" itemprop="dateModified" datetime="2018-09-06T11:06:43+08:00">2018-09-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h2><blockquote>
<p>设置查询参数</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.juphy.cn/todos?_page=1&amp;_limit=10</span><br></pre></td></tr></table></figure>


<blockquote>
<p>创建HttpParams对象</p>
</blockquote>
<ol>
<li><p>直接链式创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; HttpClient, HttpParams &#125; from &apos;@angular/common/http&apos;;</span><br><span class="line"></span><br><span class="line">const params = new HttpParams().set(&apos;_page&apos;, 1).set(&apos;_limit&apos;, 10);</span><br><span class="line"></span><br><span class="line">this.http.get(&apos;https://www.juphy.cn/todos&apos;, &#123;params&#125;);</span><br></pre></td></tr></table></figure>
<p>通过链式语法调用 set() 方法，构建 HttpParams 对象。这是因为HttpParams对象是不可变的，通过set() 方法可以防止该对象被修改。每当调用 set() 方法，将会返回包含新值的 HttpParams 对象。</p>
</li>
<li><p>使用formString</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const params = new HttpParams(&#123;formString: &apos;_page=1&amp;_limit=10&apos;&#125;);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用formObject</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const params = new HttpParams(&#123; fromObject: &#123; _page: &quot;1&quot;, _limit: &quot;10&quot; &#125; &#125;);</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>使用request API</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.http.request(&apos;GET&apos;, &apos;https://www.juphy.cn/todos&apos;, &#123;params&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="获取完整响应"><a href="#获取完整响应" class="headerlink" title="获取完整响应"></a>获取完整响应</h2><p>默认情况下，httpClient服务返回的是响应体，如果需要获取响应头的相关信息，可以设置options的对象的observe属性值为response来获取完整的响应对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">this.http.get(&apos;https://www.juphy.cn/todos&apos;,&#123;</span><br><span class="line">    observe: &apos;response&apos;</span><br><span class="line">&#125;).subscribe(res =&gt; &#123;</span><br><span class="line">    console.dir(&apos;Response:&apos;+res.status);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="设置响应类型"><a href="#设置响应类型" class="headerlink" title="设置响应类型"></a>设置响应类型</h2><p>options设置responseType属性的值，’text’,’arraybuffer’,’blob’。</p>
<h2 id="设置Http-Headers"><a href="#设置Http-Headers" class="headerlink" title="设置Http Headers"></a>设置Http Headers</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const params = new HttpParams(&#123; fromObject: &#123; _page: &quot;1&quot;, _limit: &quot;10&quot; &#125; &#125;);</span><br><span class="line">const headers = new HttpHeaders().set(&apos;Content-Type&apos;, &apos;application/json; charset=UTF-8&apos;);</span><br><span class="line">this.http.get(&apos;url&apos;, &#123;headers, params&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="多个http请求"><a href="#多个http请求" class="headerlink" title="多个http请求"></a>多个http请求</h2><h3 id="并行发送"><a href="#并行发送" class="headerlink" title="并行发送"></a>并行发送</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const parallel$ = forkJoin(</span><br><span class="line">    this.http.get(&apos;url1&apos;),</span><br><span class="line">    this.http.get(&apos;url2&apos;)</span><br><span class="line">);</span><br><span class="line">parallel$.subscribe(res =&gt;&#123;</span><br><span class="line">    res是一个数组包含多个请求返回的结果。</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="顺序发送"><a href="#顺序发送" class="headerlink" title="顺序发送"></a>顺序发送</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const sequence$ = this.http.get(&apos;url1&apos;)</span><br><span class="line">    .pipe(</span><br><span class="line">        switchMap(res =&gt;&#123;</span><br><span class="line">            // 此res是url1返回的结果</span><br><span class="line">            return this.http.get(&apos;url2&apos;);</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">    sequence$.subscribe(res=&gt;&#123;</span><br><span class="line">        res// 此res是url2返回的结果</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="控制返回结果"><a href="#控制返回结果" class="headerlink" title="控制返回结果"></a>控制返回结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const sequence$ = this.http.get(&apos;url1&apos;)</span><br><span class="line">    .pipe(</span><br><span class="line">        switchMap(res =&gt;&#123;</span><br><span class="line">            // 此res是url1返回的结果</span><br><span class="line">            return this.http.get(&apos;url2&apos;);</span><br><span class="line">        &#125;, (res1, res2) =&gt; [res1, res2]) // 此处控制返回结果</span><br><span class="line">    );</span><br><span class="line">    sequence$.subscribe(res=&gt;&#123;</span><br><span class="line">        res; // [res1, res2]</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h2 id="请求异常处理"><a href="#请求异常处理" class="headerlink" title="请求异常处理"></a>请求异常处理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; of &#125; from &quot;rxjs&quot;;</span><br><span class="line">import &#123; catchError &#125; from &quot;rxjs/operators&quot;;</span><br><span class="line"></span><br><span class="line">this.http.get(&apos;url&apos;).pipe(</span><br><span class="line">    catchError(error =&gt; &#123;</span><br><span class="line">        console.error(&apos;Error catched&apos;, error);</span><br><span class="line">        return of(&#123;description: &apos;Error Value Emitted&apos;&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">).subscribe(res =&gt; console.log(res));</span><br></pre></td></tr></table></figure>

<h2 id="Http拦截器"><a href="#Http拦截器" class="headerlink" title="Http拦截器"></a>Http拦截器</h2><h3 id="定义拦截器"><a href="#定义拦截器" class="headerlink" title="定义拦截器"></a>定义拦截器</h3><p>拦截器提供了一种用于拦截、修改请求和响应的机制，类似于express中间件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Injectable &#125; from &quot;@angular/core&quot;;</span><br><span class="line">import &#123; HttpEvent, HttpRequest, HttpHandler, HttpInterceptor &#125; from &quot;@angular/common/http&quot;;</span><br><span class="line">import &#123; Observable, of, throwError &#125; from &apos;rxjs&apos;;</span><br><span class="line">import &#123; mergeMap, catchError &#125; from &apos;rxjs/operators&apos;;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line">// 定义一个类并实现HttpInterceptor接口</span><br><span class="line">export class DefaultInterceptor implements HttpInterceptor &#123;</span><br><span class="line">  constructor(private injector: Injector)&#123;&#125;</span><br><span class="line"></span><br><span class="line">  private handleData(</span><br><span class="line">    event: HttpResponse&lt;any&gt; | HttpErrorResponse</span><br><span class="line">  ): Observable&lt;any&gt;&#123;</span><br><span class="line">    console.log(event);</span><br><span class="line">    switch(event.status)&#123;</span><br><span class="line">        case 200:</span><br><span class="line">        break;</span><br><span class="line">        case 401:</span><br><span class="line">        break;</span><br><span class="line">        case 403:</span><br><span class="line">        break;</span><br><span class="line">        case 404:</span><br><span class="line">        break;</span><br><span class="line">        case 500:</span><br><span class="line">        break;</span><br><span class="line">        default:</span><br><span class="line">            if(event instanceof HttpErrorResponse)&#123;</span><br><span class="line">                console.warn(</span><br><span class="line">                    &apos;未可知错误，大部分是由于后端不支持CORS或无效配置引起&apos;,</span><br><span class="line">                    event</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    return of(event);</span><br><span class="line">  &#125;</span><br><span class="line">  intercept(</span><br><span class="line">    req: HttpRequest&lt;any&gt;, // HttpRequest，即请求对象</span><br><span class="line">    next: HttpHandler // HttpHandler，该对象有一个handle()方法，该方法返回一个Observable对象。</span><br><span class="line">  ): Observable&lt;HttpEvent&lt;any&gt;&gt; &#123;</span><br><span class="line">     let url= req.url; // 设置url形式，统一加上服务端前缀</span><br><span class="line">     const newReq = req.clone(</span><br><span class="line">        url: url,</span><br><span class="line">        headers: req.headers.set(&quot;X-CustomAuthHeader&quot;, &quot;iloveangular&quot;)</span><br><span class="line">     );</span><br><span class="line">     return next.handle(newReq).pipe(</span><br><span class="line">        mergeMap((event: any) =&gt; &#123;</span><br><span class="line">            // 允许统一对请求错误进行处理，这是因为一个请求若是业务上错误的情况下其HTTP请求的状态是200的情况下需要</span><br><span class="line">            if(event instanceof HttpReponse &amp;&amp; event.status === 200) return this.handleData(event);</span><br><span class="line">            // 若一切正常，则后续操作</span><br><span class="line">            return of(event);</span><br><span class="line">        &#125;),</span><br><span class="line">        catchError((err: HttpErrorResponse) =&gt; this.handleData(err))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CachingInterceptor"><a href="#CachingInterceptor" class="headerlink" title="CachingInterceptor"></a>CachingInterceptor</h3><p>拦截器实现简单的缓存控制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">定义一个Cache接口：</span><br><span class="line">import &#123; HttpRequest, HttpResponse &#125; from &apos;@angular/common/http&apos;;</span><br><span class="line"></span><br><span class="line">export interface Cache &#123;</span><br><span class="line">  get(req: HttpRequest&lt;any&gt;): HttpResponse&lt;any&gt; | null;</span><br><span class="line">  put(req: HttpRequest&lt;any&gt;, res: HttpResponse&lt;any&gt;): void;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>get(req: HttpRequest): HttpResponse | null —— 用于获取 req 请求对象对应的响应对象；</li>
<li>put(req: HttpRequest, res: HttpResponse): void; —— 用于保存 req 对象对应的响应对象。</li>
</ul>
<p>在实际的场景中，一般会设置一个最大的缓存时间，即缓存的有效期，在有效期内，如果缓存存在，则会直接返回已缓存的响应对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; HttpResponse &#125; from &quot;@angular/common/http&quot;;</span><br><span class="line"></span><br><span class="line">export const MAX_CACHE_AGE = 30000; // 单位为毫秒</span><br><span class="line"></span><br><span class="line">export interface CacheEntry &#123;</span><br><span class="line">  url: string;</span><br><span class="line">  response: HttpResponse&lt;any&gt;;</span><br><span class="line">  entryTime: number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>url: string —— 被缓存的请求 URL 地址</li>
<li>response: HttpResponse —— 被缓存的响应对象</li>
<li>entryTime: number —— 响应对象被缓存的时间，用于判断缓存是否过期</li>
</ul>
<p>实现CacheService</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Injectable &#125; from &quot;@angular/core&quot;;</span><br><span class="line">import &#123; HttpRequest, HttpResponse &#125; from &quot;@angular/common/http&quot;;</span><br><span class="line">import &#123; Cache &#125; from &quot;./cache&quot;;</span><br><span class="line">import &#123; CacheEntry, MAX_CACHE_AGE &#125; from &quot;./cache.entry&quot;;</span><br><span class="line"></span><br><span class="line">@Injectable(&#123;</span><br><span class="line">  providedIn: &quot;root&quot;</span><br><span class="line">&#125;)</span><br><span class="line">export class CacheService implements Cache &#123;</span><br><span class="line">  cacheMap = new Map&lt;string, CacheEntry&gt;();</span><br><span class="line"></span><br><span class="line">  constructor() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  get(req: HttpRequest&lt;any&gt;): HttpResponse&lt;any&gt; | null &#123;</span><br><span class="line">    // 判断当前请求是否已被缓存，若未缓存则返回null</span><br><span class="line">    const entry = this.cacheMap.get(req.urlWithParams);</span><br><span class="line">    if (!entry) return null;</span><br><span class="line">    // 若缓存存在，则判断缓存是否过期，若已过期则返回null。否则返回请求对应的响应对象</span><br><span class="line">    const isExpired = Date.now() - entry.entryTime &gt; MAX_CACHE_AGE;</span><br><span class="line">    console.log(`req.urlWithParams is Expired: $&#123;isExpired&#125; `);</span><br><span class="line">    return isExpired ? null : entry.response;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  put(req: HttpRequest&lt;any&gt;, res: HttpResponse&lt;any&gt;): void &#123;</span><br><span class="line">    // 创建CacheEntry对象</span><br><span class="line">    const entry: CacheEntry = &#123;</span><br><span class="line">      url: req.urlWithParams,</span><br><span class="line">      response: res,</span><br><span class="line">      entryTime: Date.now()</span><br><span class="line">    &#125;;</span><br><span class="line">    console.log(`Save entry.url response into cache`);</span><br><span class="line">    // 以请求url作为键，CacheEntry对象为值，保存到cacheMap中。并执行</span><br><span class="line">    // 清理操作，即清理已过期的缓存。</span><br><span class="line">    this.cacheMap.set(req.urlWithParams, entry);</span><br><span class="line">    this.deleteExpiredCache();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  private deleteExpiredCache() &#123;</span><br><span class="line">    this.cacheMap.forEach(entry =&gt; &#123;</span><br><span class="line">      if (Date.now() - entry.entryTime &gt; MAX_CACHE_AGE) &#123;</span><br><span class="line">        this.cacheMap.delete(entry.url);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现CachingInterceptor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import &#123; CacheService &#125; from &apos;../cache.service&apos;;</span><br><span class="line">const CACHABLE_URL = &apos;url&apos;;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line">export class CachingInterceptor implements HttpInterceptor &#123;</span><br><span class="line">    constructor(private cache: CacheService) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler) &#123;</span><br><span class="line">        // 判断当前请求是否可缓存</span><br><span class="line">        if (!this.isRequestCachable(req)) &#123;</span><br><span class="line">           return next.handle(req);</span><br><span class="line">        &#125;</span><br><span class="line">        // 获取请求对应的缓存对象，若存在则直接返回该请求对象对应的缓存对象</span><br><span class="line">        const cachedResponse = this.cache.get(req);</span><br><span class="line">        if (cachedResponse !== null) &#123;</span><br><span class="line">           return of(cachedResponse);</span><br><span class="line">        &#125;</span><br><span class="line">        // 发送请求至API站点，请求成功后保存至缓存中</span><br><span class="line">        return next.handle(req).pipe(</span><br><span class="line">           tap(event =&gt; &#123;</span><br><span class="line">              if (event instanceof HttpResponse) &#123;</span><br><span class="line">                this.cache.put(req, event);</span><br><span class="line">              &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 判断当前请求是否可缓存</span><br><span class="line">    private isRequestCachable(req: HttpRequest&lt;any&gt;) &#123;</span><br><span class="line">        return (req.method === &apos;GET&apos;) &amp;&amp; (req.url.indexOf(CACHABLE_URL) &gt; -1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="应用拦截器"><a href="#应用拦截器" class="headerlink" title="应用拦截器"></a>应用拦截器</h3><p>app.module.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import DefaultInterceptor</span><br><span class="line">@NgModule(&#123;</span><br><span class="line">  declarations: [AppComponent],</span><br><span class="line">  imports: [BrowserModule, HttpClientModule],</span><br><span class="line">  providers: [</span><br><span class="line">    &#123; provide: HTTP_INTERCEPTORS, useClass: AuthInterceptor, multi: true &#125;</span><br><span class="line">  ],</span><br><span class="line">  bootstrap: [AppComponent]</span><br><span class="line">&#125;)</span><br><span class="line">export class AppModule &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Http进度事件"><a href="#Http进度事件" class="headerlink" title="Http进度事件"></a>Http进度事件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">this.http.get(&apos;url&apos;, &#123;</span><br><span class="line">    observe: &apos;events&apos;,</span><br><span class="line">    reportProgress: true</span><br><span class="line">&#125;).subscribe((event: HttpEvent&lt;any&gt;) =&gt; &#123;</span><br><span class="line">    switch(event.type)&#123;</span><br><span class="line">          case HttpEventType.Sent:</span><br><span class="line">            console.log(&quot;Request sent!&quot;);</span><br><span class="line">            break;</span><br><span class="line">          case HttpEventType.ResponseHeader:</span><br><span class="line">            console.log(&quot;Response header received!&quot;);</span><br><span class="line">            break;</span><br><span class="line">          case HttpEventType.DownloadProgress:</span><br><span class="line">            const kbLoaded = Math.round(event.loaded / 1024);</span><br><span class="line">            console.log(`Download in progress! $&#123;kbLoaded&#125;Kb loaded`);</span><br><span class="line">            break;</span><br><span class="line">          case HttpEventType.Response:</span><br><span class="line">            console.log(&quot;Done!&quot;, event.body);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>控制台输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Request sent!</span><br><span class="line">Response header received!</span><br><span class="line">Download in progress! 6Kb loaded</span><br><span class="line">Download in progress! 24Kb loaded</span><br><span class="line">Done!</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">this.http.get(&apos;url&apos;, &#123;</span><br><span class="line">    observe: &apos;events&apos;,</span><br><span class="line">    reportProgress: true</span><br><span class="line">&#125;).subscribe((event: HttpEvent&lt;any&gt;) =&gt; &#123;</span><br><span class="line">    switch(event.type)&#123;</span><br><span class="line">          case HttpEventType.Sent:</span><br><span class="line">            console.log(&quot;Request sent!&quot;);</span><br><span class="line">            break;</span><br><span class="line">          case HttpEventType.ResponseHeader:</span><br><span class="line">            console.log(&quot;Response header received!&quot;);</span><br><span class="line">            break;</span><br><span class="line">          case HttpEventType.DownloadProgress:</span><br><span class="line">            const kbLoaded = Math.round(event.loaded / 1024);</span><br><span class="line">            console.log(`Download in progress! $&#123;kbLoaded&#125;Kb loaded`);</span><br><span class="line">            break;</span><br><span class="line">          case HttpEventType.Response:</span><br><span class="line">            console.log(&quot;Done!&quot;, event.body);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>控制台输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Request sent!</span><br><span class="line">Response header received!</span><br><span class="line">Download in progress! 6Kb loaded</span><br><span class="line">Download in progress! 24Kb loaded</span><br><span class="line">Done!</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.juphy.cn/blogs/1e68471e.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Juphy">
      <meta itemprop="description" content="挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="挽留之王小石">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blogs/1e68471e.html" class="post-title-link" itemprop="url">JavaScript读写excel文件</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-04 14:56:00" itemprop="dateCreated datePublished" datetime="2018-09-04T14:56:00+08:00">2018-09-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-09-05 09:58:30" itemprop="dateModified" datetime="2018-09-05T09:58:30+08:00">2018-09-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><blockquote>
<p>使用npm</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install xlsx -S</span><br></pre></td></tr></table></figure>

<blockquote>
<p>直接使用</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&quot;javascript&quot; src=&quot;xlsx.full.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>老版本浏览器</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- add the shim first --&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;shim.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;!-- after the shim is referenced, add the library --&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;xlsx.full.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Angular-2"><a href="#Angular-2" class="headerlink" title="Angular 2+"></a>Angular 2+</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import * as XLSX from &apos;xlsx&apos;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>sheet_to_json</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/* &lt;input type=&quot;file&quot; (change)=&quot;onFileChange($event)&quot; multiple=&quot;false&quot; /&gt; */</span><br><span class="line"></span><br><span class="line">  onFileChange(evt: any) &#123;</span><br><span class="line">    /* wire up file reader */</span><br><span class="line">    const target: DataTransfer = &lt;DataTransfer&gt;(evt.target);</span><br><span class="line">    if (target.files.length !== 1) throw new Error(&apos;Cannot use multiple files&apos;);</span><br><span class="line">    const reader: FileReader = new FileReader();</span><br><span class="line">    reader.onload = (e: any) =&gt; &#123;</span><br><span class="line">      /* read workbook */</span><br><span class="line">      const bstr: string = e.target.result;</span><br><span class="line">      const wb: XLSX.WorkBook = XLSX.read(bstr, &#123;type: &apos;binary&apos;&#125;);</span><br><span class="line"></span><br><span class="line">      /* grab first sheet */</span><br><span class="line">      const wsname: string = wb.SheetNames[0];</span><br><span class="line">      const ws: XLSX.WorkSheet = wb.Sheets[wsname];</span><br><span class="line"></span><br><span class="line">      /* save data */</span><br><span class="line">      this.data = &lt;AOA&gt;(XLSX.utils.sheet_to_json(ws, &#123;header: 1&#125;));</span><br><span class="line">    &#125;;</span><br><span class="line">    reader.readAsBinaryString(target.files[0]);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>结合Ant Design使用</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">&lt;nz-upload [nzBeforeUpload]=&quot;beforeUpload&quot;&gt;</span><br><span class="line">   &lt;button nz-button&gt;导入文件&lt;/button&gt;</span><br><span class="line">&lt;/nz-upload&gt;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">reader: FileReader = new FileReader();</span><br><span class="line"></span><br><span class="line">constructor()&#123;</span><br><span class="line">    this.reader.onloadstart=()=&gt;&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    this.reader.onload = (e: any)=&gt;&#123;</span><br><span class="line">        const bstr: string = e.target.result;</span><br><span class="line">        const wb: XLSX.WorkBook = XLSX.read(bstr, &#123;type: &apos;binary&apos;&#125;);</span><br><span class="line">        const sheet = wb.Sheets[wb.SheetNames[0]];</span><br><span class="line">        const json = XLSX.utils.sheet_to_json(sheet);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    this.header.onloadend = () =&gt;&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">beforeUpload = (file: UploadFile): boolean =&gt; &#123;</span><br><span class="line">  this.reader.readAsBinaryString(this.file);</span><br><span class="line">  return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>json_to_sheet/aoa_to_sheet</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/* generate worksheet */</span><br><span class="line">const ws: XLSX.WorkSheet = XLSX.utils.json_to_sheet(data);</span><br><span class="line">const ws: XLSX.WorkSheet = XLSX.utils.aoa_to_sheet(data);</span><br><span class="line"></span><br><span class="line">/* generate workbook and add the worksheet */</span><br><span class="line">const wb: XLSX.WorkBook = XLSX.utils.book_new();</span><br><span class="line">XLSX.utils.book_append_sheet(wb, ws, &apos;Sheet1&apos;);</span><br><span class="line"></span><br><span class="line">/* save to file */</span><br><span class="line">XLSX.writeFile(wb, &apos;SheetJS.xlsx&apos;);</span><br><span class="line"></span><br><span class="line">或者使用file-saver中的saveAs</span><br><span class="line"></span><br><span class="line">import &#123;saveAs&#125; from &apos;file-save</span><br><span class="line"></span><br><span class="line">const wbout: string = XLSX.write(wb, &#123;bookType: &apos;xlsx&apos;, bookSST: true, type: &apos;binary&apos;&#125;);</span><br><span class="line"></span><br><span class="line">const s2ab = (s: any) =&gt; &#123;</span><br><span class="line">    const buf = new ArrayBuffer(s.length);</span><br><span class="line">    const view = new Uint8Array(buf);</span><br><span class="line">    for (let i = 0; i !== s.length; ++i) view[i] = s.charCodeAt(i) &amp; 0xFF;</span><br><span class="line">    return buf;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">saveAs(new Blob([s2ab(wbout)], &#123;type: &apos;application/octet-stream&apos;&#125;), &apos;sheetJS.xlsx&apos;);</span><br></pre></td></tr></table></figure>

<h2 id="XMLHttpRequest-and-fetch"><a href="#XMLHttpRequest-and-fetch" class="headerlink" title="XMLHttpRequest and fetch"></a>XMLHttpRequest and fetch</h2><blockquote>
<p>GET</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let xhr = XMLHttpRequest();</span><br><span class="line">req.open(&apos;GET&apos;, &apos;sheetjs.xlsx&apos;, true);</span><br><span class="line">req.onload = function(e)&#123;</span><br><span class="line">    此时req.response是一个ArrayBuffer，通过new Uint8Array()创建不带符号整数的Uint8Array构造函数。</span><br><span class="line">    let data = new Uint8Array(req.response);</span><br><span class="line">    let wb = XLSX.read(data, &#123;type: &quot;array&quot;&#125;);</span><br><span class="line">    document.getElementById(&apos;xxx&apos;).innerHTML = XLSX.units.sheet_to_html(wb.Sheets[wb.SheetNames[0]],&#123;editable: true&#125;).replace(&quot;&lt;table&quot;,&apos;&lt;table id=&quot;table&quot; border=&quot;1&quot;&apos;);</span><br><span class="line">&#125;</span><br><span class="line">req.send();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>POST</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let wb = XLSX.utils.table_to_book(document.getElementById(&apos;xxx&apos;));</span><br><span class="line">let fd = new FormData();</span><br><span class="line">let data = XLSX.write(wb, &#123;bookType: &apos;文件格式&apos;, type: &apos;array&apos;&#125;);</span><br><span class="line">fd.append(&apos;data&apos;, new File([data], &apos;文件名&apos;+&apos;.&apos;+&apos;文件格式(csv, xlsx, xls等)&apos;));</span><br><span class="line">req.open(&apos;POST&apos;, url, true);</span><br><span class="line">req.send(fd);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在angular2+中使用</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.http.get(&apos;sheetjs.xlsx&apos;, &#123;responseType: &apos;arraybuffer&apos;&#125;).subscribe(res =&gt;&#123;</span><br><span class="line">    console.log(res);   // res是ArrayBuffer</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let wb = XLSX.utils.table_to_book(document.getElementById(&apos;xxx&apos;));</span><br><span class="line">let fd = new FormData();</span><br><span class="line">let data = XLSX.write(wb, &#123;bookType: &apos;文件格式&apos;, type: &apos;array&apos;&#125;);</span><br><span class="line">fd.append(&apos;data&apos;, new File([data], &apos;文件名.格式名&apos;));</span><br><span class="line">this.http.post(&apos;url&apos;, fd, &#123;&apos;responseType&apos;: &apos;blob&apos;或者&apos;arraybuffer&apos;&#125;).subscribe(res =&gt;&#123;</span><br><span class="line">   console.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>nodejs后端：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.post(&apos;/upload&apos;, (req, res) =&gt;&#123;</span><br><span class="line">    res.header(&apos;Access-Control-Allow-Origin&apos;, &apos;*&apos;);</span><br><span class="line">    let f = req.files[Object.keys(req.files)[0]];</span><br><span class="line">    // f.name 生成的excel的名字和格式</span><br><span class="line">    let newpath = path.join(__dirname, f.name); // 定义新文件所在的位置</span><br><span class="line">    fs.renameSync(f.path, newpath);</span><br><span class="line">    re.end(&apos;xx&apos;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="其他使用功能"><a href="#其他使用功能" class="headerlink" title="其他使用功能"></a>其他使用功能</h2><blockquote>
<p>修改某一单元的数据，合并单元格问题</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const ws: any = XLSX.utils.json_to_sheet(data);</span><br><span class="line">// 修改填充的数据</span><br><span class="line">ws[&apos;A1&apos;]=&#123;t: &apos;s&apos;, v: &apos;需要填写的内容&apos;&#125;;</span><br><span class="line">ws[&apos;A2&apos;]=&#123;t: &apos;s&apos;, v: &apos;需要填写的内容&apos;&#125;;</span><br><span class="line">ws[&apos;A3&apos;]=&#123;t: &apos;s&apos;, v: &apos;需要填写的内容&apos;&#125;;</span><br><span class="line"></span><br><span class="line">// 合并单元格</span><br><span class="line">/*</span><br><span class="line">c: 代表纵向，从0开始</span><br><span class="line">r: 代表横向，从0开始</span><br><span class="line">*/</span><br><span class="line">ws[&apos;!merges&apos;]=[</span><br><span class="line">    &#123;</span><br><span class="line">    s: &#123;c: 0, r: 0&#125;,</span><br><span class="line">    e: &#123;c: 10, r: 0&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    s: &#123;c: 1, r: 0&#125;,</span><br><span class="line">    e: &#123;c: 1, r: 10&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>单元格</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">Key</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">v</td>
<td align="center">原始值</td>
</tr>
<tr>
<td align="center">w</td>
<td align="center">格式化文本</td>
</tr>
<tr>
<td align="center">t</td>
<td align="center">type: b Boolean, e Error, n Number, d Date, s Text, z Stub</td>
</tr>
</tbody></table>
<blockquote>
<p>多种导出形式</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt; Importing:</span><br><span class="line">aoa_to_sheet converts an array of arrays of JS data to a worksheet.</span><br><span class="line">json_to_sheet converts an array of JS objects to a worksheet.</span><br><span class="line">table_to_sheet converts a DOM TABLE element to a worksheet.</span><br><span class="line">sheet_add_aoa adds an array of arrays of JS data to an existing worksheet.</span><br><span class="line">sheet_add_json adds an array of JS objects to an existing worksheet.</span><br><span class="line"></span><br><span class="line">&gt; Exporting:</span><br><span class="line">sheet_to_json converts a worksheet object to an array of JSON objects.</span><br><span class="line">sheet_to_csv generates delimiter-separated-values output.</span><br><span class="line">sheet_to_txt generates UTF16 formatted text.</span><br><span class="line">sheet_to_html generates HTML output.</span><br><span class="line">sheet_to_formulae generates a list of the formulae (with value fallbacks).</span><br><span class="line"></span><br><span class="line">&gt; Cell and cell address manipulation:</span><br><span class="line">format_cell generates the text value for a cell (using number formats).</span><br><span class="line">encode_row / decode_row converts between 0-indexed rows and 1-indexed rows.</span><br><span class="line">encode_col / decode_col converts between 0-indexed columns and column names.</span><br><span class="line">encode_cell / decode_cell converts cell addresses.</span><br><span class="line">encode_range / decode_range converts cell ranges.</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/SheetJS/js-xlsx" target="_blank" rel="noopener">详细使用SheetJS</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.juphy.cn/blogs/c64e9b3c.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Juphy">
      <meta itemprop="description" content="挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="挽留之王小石">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blogs/c64e9b3c.html" class="post-title-link" itemprop="url">Angular管道</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-02 14:56:00" itemprop="dateCreated datePublished" datetime="2018-09-02T14:56:00+08:00">2018-09-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-09-04 12:18:40" itemprop="dateModified" datetime="2018-09-04T12:18:40+08:00">2018-09-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="内置管道"><a href="#内置管道" class="headerlink" title="内置管道"></a>内置管道</h2><h3 id="大小写转换"><a href="#大小写转换" class="headerlink" title="大小写转换"></a>大小写转换</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&#123;&#123;&apos;Angular&apos; | uppercase&#125;&#125;&lt;/p&gt; // ANGULAR</span><br><span class="line">&lt;p&gt;&#123;&#123;&apos;Angular&apos; | lowercase&#125;&#125;&lt;/p&gt; // angular</span><br></pre></td></tr></table></figure>
<h3 id="数值格式化"><a href="#数值格式化" class="headerlink" title="数值格式化"></a>数值格式化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pi: number = 3.14</span><br><span class="line">e: number = 2.718281828</span><br><span class="line">&lt;p&gt;&#123;&#123;e | number: &apos;3.1-5&apos;&#125;&#125;&lt;/p&gt; // 002.71828</span><br><span class="line">&lt;p&gt;&#123;&#123;e | number: &apos;4.5-5&apos;&#125;&#125;&lt;/p&gt; // 0,002.71828</span><br><span class="line">&lt;p&gt;&#123;&#123;e | number: &apos;4.0&apos;&#125;&#125;&lt;/p&gt; // 0,002.718</span><br><span class="line">&lt;p&gt;&#123;&#123;e | number: &apos;4.&apos;&#125;&#125;&lt;/p&gt; // 0,002.718</span><br></pre></td></tr></table></figure>
<p><code>{minIntegerDigits}.{minFractionDigits}-{maxfractionDigits}</code></p>
<ul>
<li>minIntegerDigits：整数部分保留最小的位数，默认值为1.</li>
<li>minFractionDigits：小数部分保留最小的位数，默认值为0.</li>
<li>maxFractionDigits：小数部分保留最大的位数，默认值为3.<br>小数点左边的数字表示最少保留的位数，如果原数值整数位不足，则用0补齐；小数点右边表示小数的最小位数和小数的最大位数，如果原值的小数位大于最大位数，要四舍五入保留到最大位数；如果原值的小数位小于最小位数，则要不足小数位补0。<h3 id="日期格式化"><a href="#日期格式化" class="headerlink" title="日期格式化"></a>日期格式化</h3></li>
</ul>
<table>
<thead>
<tr>
<th align="left">日期</th>
<th align="left">标志符</th>
<th align="left">缩写</th>
<th align="left">全称</th>
<th align="left">单标志符</th>
<th align="left">双标志符</th>
</tr>
</thead>
<tbody><tr>
<td align="left">地区</td>
<td align="left">G</td>
<td align="left">G(AD)</td>
<td align="left">GGGG(Anno Domini)</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">年</td>
<td align="left">y</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">y(2016)</td>
<td align="left">yy(16)</td>
</tr>
<tr>
<td align="left">月</td>
<td align="left">M</td>
<td align="left">MMM(Jun)</td>
<td align="left">MMMM(June)</td>
<td align="left">M(6)</td>
<td align="left">MM(06)</td>
</tr>
<tr>
<td align="left">日</td>
<td align="left">d</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">d(8)</td>
<td align="left">dd(08)</td>
</tr>
<tr>
<td align="left">星期</td>
<td align="left">E</td>
<td align="left">E,EE,EEE(Fri)</td>
<td align="left">EEEE(Friday)</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">时间(AM,PM)</td>
<td align="left">j</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">j(8 PM)</td>
<td align="left">jj(08 PM)</td>
</tr>
<tr>
<td align="left">12小时制</td>
<td align="left">h</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">h(8)</td>
<td align="left">hh(08)</td>
</tr>
<tr>
<td align="left">24小时制</td>
<td align="left">H</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">H(20)</td>
<td align="left">HH(20)</td>
</tr>
<tr>
<td align="left">分</td>
<td align="left">m</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">m(5)</td>
<td align="left">mm(05)</td>
</tr>
<tr>
<td align="left">秒</td>
<td align="left">s</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">s(8)</td>
<td align="left">ss(08)</td>
</tr>
<tr>
<td align="left">时区</td>
<td align="left">Z</td>
<td align="left"></td>
<td align="left">Z(china Standard Time)</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">时区</td>
<td align="left">z</td>
<td align="left">z(GMT-8:00)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date:Date = new Date(&apos;2016-06-08 20:05:08&apos;);</span><br><span class="line">&lt;p&gt;&#123;&#123;date | date: &quot;y-MM-dd EEEE&quot;&#125;&#125;&lt;/p&gt; //2016-06-08 Wednesday</span><br></pre></td></tr></table></figure>
<h3 id="PercentPipe"><a href="#PercentPipe" class="headerlink" title="PercentPipe"></a>PercentPipe</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = 0.269</span><br><span class="line">&lt;p&gt;&#123;&#123;a | percent&#125;&#125;&lt;/p&gt; // 27%</span><br><span class="line">&lt;p&gt;&#123;&#123;a | percent:&apos;4.3-5&apos;&#125;&#125;&lt;/p&gt; // 0,026.900%</span><br></pre></td></tr></table></figure>
<p><code>{ value_expression | percent [:digitsInfo[:locale]] }</code><br>如果没有digitsInfo则按照整数取（四舍五入），如果有digitsInfo，则按照规则取。</p>
<h3 id="CurrencyPipe"><a href="#CurrencyPipe" class="headerlink" title="CurrencyPipe"></a>CurrencyPipe</h3><p><code>expression | currency[: currencyCode[: display[: digitInfo]]]</code></p>
<ul>
<li>currency 要显示内容（如’USD’，也可以是自定义的）</li>
<li>currencyCode<ul>
<li>‘code’ 显示内容（如’USD’）</li>
<li>‘symbol’（默认） 显示符号（例如$）</li>
<li>‘symbol-narrow’</li>
<li>布尔值 true用于符号 false用于code</li>
</ul>
</li>
<li>digitInfo 按照数值的规则</li>
</ul>
<h3 id="SlicePipe（非纯管道）"><a href="#SlicePipe（非纯管道）" class="headerlink" title="SlicePipe（非纯管道）"></a>SlicePipe（非纯管道）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str = &apos;abcdefghij&apos;;</span><br><span class="line">&lt;p&gt;&#123;&#123;str | slice:0:4&#125;&#125;&lt;/p&gt; // &apos;abcd&apos;</span><br><span class="line">&lt;p&gt;&#123;&#123;str | slice:4:0&#125;&#125;&lt;/p&gt; // &apos;&apos;</span><br><span class="line">&lt;p&gt;&#123;&#123;str | slice:-4&#125;&#125;&lt;/p&gt; // &apos;ghij&apos;</span><br></pre></td></tr></table></figure>

<h3 id="JsonPipe（非纯管道）"><a href="#JsonPipe（非纯管道）" class="headerlink" title="JsonPipe（非纯管道）"></a>JsonPipe（非纯管道）</h3><p>将数据对象通过JSON.stringify()转换成对象字符串，并不改变原数据。</p>
<h2 id="管道分类"><a href="#管道分类" class="headerlink" title="管道分类"></a>管道分类</h2><h3 id="纯管道"><a href="#纯管道" class="headerlink" title="纯管道"></a>纯管道</h3><p>仅当管道输入值变化的时候，才执行转换操作，默认的类型是 pure 类型。（备注：输入值变化是指原始数据类型如：string、number、boolean、Symbol等的数值发生变化或者对对象引用（Date、Array、Function、Object）的更改）。Angular会忽略对象内部的更改，除非是引用地址的变化。</p>
<p>纯管道使用纯函数， 纯函数是指在处理输入并返回结果时，不会产生任何副作用的函数。 给定相同的输入，它们总是返回相同的输出。</p>
<h3 id="非纯管道"><a href="#非纯管道" class="headerlink" title="非纯管道"></a>非纯管道</h3><p>angular组件在每次变化检测期间都会执行，如鼠标点击或移动都会执行 impure 管道。非纯管道可能会被调用很多次，因此必须小心使用非纯管道。</p>
<p>将管道设置为非纯管道：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Pipe(&#123;</span><br><span class="line">    name: &apos;SexReformPipe&apos;,</span><br><span class="line">    pure: false</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="管道链"><a href="#管道链" class="headerlink" title="管道链"></a>管道链</h2><p>将多个管道用<code>|</code>连接在一起，组成管道链对数据进行处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&#123;&#123;&apos;abcdefgh&apos; | slice:0:3 | uppercase&#125;&#125;&lt;/p&gt;  // &apos;ABC&apos;</span><br></pre></td></tr></table></figure>

<h2 id="自定义管道"><a href="#自定义管道" class="headerlink" title="自定义管道"></a>自定义管道</h2><ul>
<li>@Pipe装饰器定义Pipe的metadata信息</li>
<li>实现PipeTransform接口中定义的transform方法，接受一个输入值和一些可选参数，并返回转换后的值</li>
<li>不可以返回html</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Pipe, PipeTransform &#125; form &apos;@angular/core&apos;</span><br><span class="line">@Pipe(&#123;name: &apos;exponentialStrength&apos;&#125;)</span><br><span class="line">export class ExponentialStrengthPipe implements PipeTransform &#123;</span><br><span class="line">  transform(value: number, exponent: string): number &#123;</span><br><span class="line">    let exp = parseFloat(exponent);</span><br><span class="line">    return Math.pow(value, isNaN(exp) ? 1 : exp);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Pipe(&#123; name: &apos;sexReform&apos; &#125;)</span><br><span class="line">export class SexReformPipe implements PipeTransform &#123;</span><br><span class="line">    transform(value: string):string&#123;</span><br><span class="line">        switch(value)&#123;</span><br><span class="line">            case &apos;male&apos;: return &apos;男&apos;;</span><br><span class="line">            case &apos;female&apos;: return &apos;女&apos;;</span><br><span class="line">            default: return &apos;&apos;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用自定义管道</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;Super power boost: &#123;&#123;2 | exponentialStrength: 10&#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123;sexValue | sexReform&#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p class=&quot;&#123;&#123;sexValue | sexReform&#125;&#125;&quot;&gt;&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<p><code>定义完管道之后，要手动注册自定义管道，添加到declarations数组中</code>。</p>
<h3 id="非纯AsyncPipe"><a href="#非纯AsyncPipe" class="headerlink" title="非纯AsyncPipe"></a>非纯AsyncPipe</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; Observable, interval &#125; from &apos;rxjs&apos;;</span><br><span class="line">import &#123; map, take &#125; from &apos;rxjs/operators&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;app-hero-message&apos;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;h2&gt;Async Hero Message and AsyncPipe&lt;/h2&gt;</span><br><span class="line">    &lt;p&gt;Message: &#123;&#123; message$ | async &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;button (click)=&quot;resend()&quot;&gt;Resend&lt;/button&gt;`,</span><br><span class="line">&#125;)</span><br><span class="line">export class HeroAsyncMessageComponent &#123;</span><br><span class="line">  message$: Observable&lt;string&gt;;</span><br><span class="line"></span><br><span class="line">  private messages = [</span><br><span class="line">    &apos;You are my hero!&apos;,</span><br><span class="line">    &apos;You are the best hero!&apos;,</span><br><span class="line">    &apos;Will you be my hero?&apos;</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  constructor() &#123; this.resend(); &#125;</span><br><span class="line"></span><br><span class="line">  resend() &#123;</span><br><span class="line">    this.message$ = interval(500).pipe(</span><br><span class="line">      map(i =&gt; this.messages[i]),</span><br><span class="line">      take(this.messages.length)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AsyncPipe接受一个Promise或Observable作为输入，并且自动订阅这个输入，最终返回他们给出的值。AsyncPipe 管道是有状态的。 该管道维护着一个所输入的 Observable 的订阅，并且持续从那个 Observable 中发出新到的值。</p>
<h3 id="非纯且带缓存的管道"><a href="#非纯且带缓存的管道" class="headerlink" title="非纯且带缓存的管道"></a>非纯且带缓存的管道</h3><p>一个向服务器发起http请求的非纯管道。此管道只有在所请求的URL发生变化时才会向服务器发起请求，他会缓存服务器的响应。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Pipe, PipeTransform &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; HttpClient &#125;          from &apos;@angular/common/http&apos;;</span><br><span class="line">@Pipe(&#123;</span><br><span class="line">  name: &apos;fetch&apos;,</span><br><span class="line">  pure: false</span><br><span class="line">&#125;)</span><br><span class="line">export class FetchJsonPipe  implements PipeTransform &#123;</span><br><span class="line">  private cachedData: any = null;</span><br><span class="line">  private cachedUrl = &apos;&apos;;</span><br><span class="line"></span><br><span class="line">  constructor(private http: HttpClient) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  transform(url: string): any &#123;</span><br><span class="line">    if (url !== this.cachedUrl) &#123;</span><br><span class="line">      this.cachedData = null;</span><br><span class="line">      this.cachedUrl = url;</span><br><span class="line">      this.http.get(url).subscribe( result =&gt; this.cachedData = result );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return this.cachedData;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在一个组件中使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;app-hero-list&apos;,</span><br><span class="line">  template: `</span><br><span class="line">    &lt;h2&gt;Heroes from JSON File&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div *ngFor=&quot;let hero of (&apos;assets/heroes.json&apos; | fetch) &quot;&gt;</span><br><span class="line">      &#123;&#123;hero.name&#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;p&gt;Heroes as JSON:</span><br><span class="line">      &#123;&#123;&apos;assets/heroes.json&apos; | fetch | json&#125;&#125;</span><br><span class="line">    &lt;/p&gt;`</span><br><span class="line">&#125;)</span><br><span class="line">export class HeroListComponent &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>assets/heroes.json</code>的数据是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;&quot;name&quot;: &quot;Windstorm&quot;, &quot;canFly&quot;: true&#125;,</span><br><span class="line">  &#123;&quot;name&quot;: &quot;Bombasto&quot;,  &quot;canFly&quot;: false&#125;,</span><br><span class="line">  &#123;&quot;name&quot;: &quot;Magneto&quot;,   &quot;canFly&quot;: false&#125;,</span><br><span class="line">  &#123;&quot;name&quot;: &quot;Tornado&quot;,   &quot;canFly&quot;: true&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>最终结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Heros from JSON File</span><br><span class="line"></span><br><span class="line">Windstorm</span><br><span class="line">Bombasto</span><br><span class="line">Magneto</span><br><span class="line">Tornado</span><br><span class="line"></span><br><span class="line">Heroes as JSON: [ &#123; &quot;name&quot;: &quot;Windstorm&quot;, &quot;canFly&quot;: true &#125;, &#123; &quot;name&quot;: &quot;Bombasto&quot;, &quot;canFly&quot;: false &#125;, &#123; &quot;name&quot;: &quot;Magneto&quot;, &quot;canFly&quot;: false &#125;, &#123; &quot;name&quot;: &quot;Tornado&quot;, &quot;canFly&quot;: true &#125; ]</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.juphy.cn/blogs/46b44a0a.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Juphy">
      <meta itemprop="description" content="挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="挽留之王小石">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blogs/46b44a0a.html" class="post-title-link" itemprop="url">JavaScript类型转换</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2018-08-31 11:22:00 / 修改时间：14:01:46" itemprop="dateCreated datePublished" datetime="2018-08-31T11:22:00+08:00">2018-08-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="显式转换"><a href="#显式转换" class="headerlink" title="显式转换"></a>显式转换</h2><p>通过手动进行类型转换，Javascript提供了以下转型函数：</p>
<ul>
<li>转换为数值类型：Number(mix)、parseInt(string,radix)、parseFloat(string)</li>
<li>转换为字符串类型：toString(radix)、String(mix)</li>
<li>转换为布尔类型：Boolean(mix)</li>
</ul>
<blockquote>
<p>1、Number(mix)函数，可以将任意类型的参数mix转换为数值类型。其规则为：</p>
</blockquote>
<ul>
<li>（1）如果是布尔值，true和false分别被转换为1和0</li>
<li>（2）如果是数字值，返回本身。</li>
<li>（3）如果是null，返回0.</li>
<li>（4）如果是undefined，返回NaN。</li>
<li>（5）如果是字符串，遵循以下规则：<ul>
<li>1、如果字符串中只包含数字，则将其转换为十进制（忽略前导0）</li>
<li>2、如果字符串中包含有效的浮点格式，将其转换为浮点数值（忽略前导0）</li>
<li>3、如果是空字符串，将其转换为0</li>
<li>4、如果字符串中包含非以上格式，则将其转换为NaN</li>
</ul>
</li>
<li>（6）如果是对象，则调用对象的valueOf()方法，然后依据前面的规则转换返回的值。如果转换的结果是NaN，则调用对象的toString()方法，再次依照前面的规则转换返回的字符串值。</li>
</ul>
<p>下表列出了对象的valueOf()的返回值：</p>
<table>
<thead>
<tr>
<th align="left">对象</th>
<th align="left">返回值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Array</td>
<td align="left">数组的元素被转换为字符串，这些字符串由逗号分隔，连接在一起。其操作与 Array.toString 和 Array.join 方法相同。</td>
</tr>
<tr>
<td align="left">Boolean</td>
<td align="left">Boolean 值。</td>
</tr>
<tr>
<td align="left">Date</td>
<td align="left">存储的时间是从 1970 年 1 月 1 日午夜开始计的毫秒数 UTC。</td>
</tr>
<tr>
<td align="left">Function</td>
<td align="left">函数本身。</td>
</tr>
<tr>
<td align="left">Number</td>
<td align="left">数字值。</td>
</tr>
<tr>
<td align="left">Object</td>
<td align="left">对象本身。这是默认情况。 “[object Object]”</td>
</tr>
<tr>
<td align="left">String</td>
<td align="left">字符串值。</td>
</tr>
</tbody></table>
<blockquote>
<p>2、parseInt(string, radix)函数，将字符串转换为整数类型的数值。它也有一定的规则：</p>
</blockquote>
<ul>
<li>（1）忽略字符串前面的空格，直至找到第一个非空字符</li>
<li>（2）如果第一个字符不是数字符号或者负号，返回NaN</li>
<li>（3）如果第一个字符是数字，则继续解析直至字符串解析完毕或者遇到一个非数字符号为止</li>
<li>（4）如果上步解析的结果以0开头，则将其当作八进制来解析；如果以0x开头，则将其当作十六进制来解析</li>
<li>（5）如果指定radix参数，则以radix为基数进行解析</li>
</ul>
<blockquote>
<p>3、parseFloat(string)函数，将字符串转换为浮点数类型的数值。</p>
</blockquote>
<p>它的规则与parseInt基本相同，但也有点区别：字符串中第一个小数点符号是有效的，另外parseFloat会忽略所有前导0，如果字符串包含一个可解析为整数的数，则返回整数值而不是浮点数值。</p>
<blockquote>
<p>4、toString(radix)方法。除undefined和null之外的所有类型的值都具有toString()方法，其作用是返回对象的字符串表示。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">对象</th>
<th align="left">操作</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Array</td>
<td align="left">将 Array 的元素转换为字符串。结果字符串由逗号分隔，且连接起来。</td>
</tr>
<tr>
<td align="left">Boolean</td>
<td align="left">如果 Boolean 值是 true，则返回 “true”。否则，返回 “false”。</td>
</tr>
<tr>
<td align="left">Date</td>
<td align="left">返回日期的文字表示法。</td>
</tr>
<tr>
<td align="left">Error</td>
<td align="left">返回一个包含相关错误信息的字符串。</td>
</tr>
<tr>
<td align="left">Function</td>
<td align="left">返回如下格式的字符串，其中 functionname 是被调用 toString 方法函数的名称：function functionname( ) { [native code] }</td>
</tr>
<tr>
<td align="left">Number</td>
<td align="left">返回数字的文字表示。</td>
</tr>
<tr>
<td align="left">String</td>
<td align="left">返回 String 对象的值。</td>
</tr>
<tr>
<td align="left">默认</td>
<td align="left">返回 “[object objectname]”，其中 objectname 是对象类型的名称。</td>
</tr>
</tbody></table>
<blockquote>
<p>5、String(mix)函数，将任何类型的值转换为字符串，其规则为：</p>
</blockquote>
<ul>
<li>（1）如果有toString()方法，则调用该方法（不传递radix参数）并返回结果</li>
<li>（2）如果是null，返回”null”</li>
<li>（3）如果是undefined，返回”undefined”</li>
</ul>
<blockquote>
<p>6、Boolean(mix)函数，将任何类型的值转换为布尔值。</p>
</blockquote>
<p>以下值会被转换为false：false、””、0、NaN、null、undefined，其余任何值都会被转换为true。</p>
<h2 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h2><p>在某些情况下，即使我们不提供显示转换，Javascript也会进行自动类型转换，主要情况有：</p>
<blockquote>
<p>1、于检测是否为非数值的函数：isNaN(mix)</p>
</blockquote>
<p>isNaN()函数，经测试发现，该函数会尝试将参数值用Number()进行转换，如果结果为“非数值”则返回true，否则返回false。</p>
<blockquote>
<p>2、递增递减操作符（包括前置和后置）、一元正负符号操作符</p>
</blockquote>
<p>这些操作符适用于任何数据类型的值，针对不同类型的值，该操作符遵循以下规则（经过对比发现，其规则与Number()规则基本相同）：</p>
<ul>
<li>（1）如果是包含有效数字字符的字符串，先将其转换为数字值（转换规则同Number()），在执行加减1的操作，字符串变量变为数值变量。</li>
<li>（2）如果是不包含有效数字字符的字符串，将变量的值设置为NaN，字符串变量变成数值变量。</li>
<li>（3）如果是布尔值false，先将其转换为0再执行加减1的操作，布尔值变量编程数值变量。</li>
<li>（4）如果是布尔值true，先将其转换为1再执行加减1的操作，布尔值变量变成数值变量。</li>
<li>（5）如果是浮点数值，执行加减1的操作。</li>
<li>（6）如果是对象，先调用对象的valueOf()方法，然后对该返回值应用前面的规则。如果结果是NaN，则调用toString()方法后再应用前面的规则。对象变量变成数值变量。</li>
</ul>
<blockquote>
<p>3、 加法运算操作符</p>
</blockquote>
<p>加号运算操作符在Javascript也用于字符串连接符，所以加号操作符的规则分两种情况：</p>
<ul>
<li>如果两个操作值都是数值，其规则为：<ul>
<li>(1)如果一个操作数为NaN，则结果为NaN</li>
<li>(2)如果是Infinity+Infinity，结果是Infinity</li>
<li>(3)如果是-Infinity+(-Infinity)，结果是-Infinity</li>
<li>(4)如果是Infinity+(-Infinity)，结果是NaN</li>
<li>(5)如果是+0+(+0)，结果为+0</li>
<li>(6)如果是(-0)+(-0)，结果为-0</li>
<li>(7)如果是(+0)+(-0)，结果为+0</li>
</ul>
</li>
<li>如果有一个操作值为字符串，则：<ul>
<li>如果两个操作值都是字符串，则将它们拼接起来</li>
<li>如果只有一个操作值为字符串，则将另外操作值转换为字符串，然后拼接起来</li>
<li>如果一个操作数是对象、数组或者布尔值，则调用toString()方法取得字符串值，然后再应用前面的字符串规则。对于undefined和null，分别调用String()显式转换为字符串。</li>
</ul>
</li>
</ul>
<p>在加法运算中，如果有一个操作值为字符串类型，则将另一个操作值转换为字符串，最后连接起来。</p>
<blockquote>
<p>4、 乘除、减号运算符、取模运算符</p>
</blockquote>
<p>这些操作符针对的是运算，所以他们具有共同性：如果操作值之一不是数值，则被隐式调用Number()函数进行转换。具体每一种运算的详细规则请参考ECMAScript中的定义。</p>
<blockquote>
<p>5、 逻辑操作符（!、&amp;&amp;、||）</p>
</blockquote>
<ul>
<li>逻辑非（！）操作符首先通过Boolean()函数将它的操作值转换为布尔值，然后求反。</li>
<li>逻辑与（&amp;&amp;）操作符，如果一个操作值不是布尔值时，遵循以下规则进行转换：<ul>
<li>（1）如果第一个操作数经Boolean()转换后为true，则返回第二个操作值，否则返回第一个值（不是Boolean()转换后的值）</li>
<li>（2）如果有一个操作值为null，返回null</li>
<li>（3）如果有一个操作值为NaN，返回NaN</li>
<li>（4）如果有一个操作值为undefined，返回undefined</li>
</ul>
</li>
<li>逻辑或（||）操作符，如果一个操作值不是布尔值，遵循以下规则：<ul>
<li>（1）如果第一个操作值经Boolean()转换后为false，则返回第二个操作值，否则返回第一个操作值（不是Boolean()转换后的值）</li>
<li>（2）对于undefined、null和NaN的处理规则与逻辑与（&amp;&amp;）相同</li>
</ul>
</li>
</ul>
<blockquote>
<p>6、 关系操作符（&lt;, &gt;, &lt;=, &gt;=）</p>
</blockquote>
<p>与上述操作符一样，关系操作符的操作值也可以是任意类型的，所以使用非数值类型参与比较时也需要系统进行隐式类型转换：<br>（1）如果两个操作值都是数值，则进行数值比较<br>（2）如果两个操作值都是字符串，则比较字符串对应的字符编码值<br>（3）如果只有一个操作值是数值，则将另一个操作值转换为数值，进行数值比较<br>（4）如果一个操作数是对象，则调用valueOf()方法（如果对象没有valueOf()方法则调用toString()方法），得到的结果按照前面的规则执行比较<br>（5）如果一个操作值是布尔值，则将其转换为数值，再进行比较<br>注：NaN是非常特殊的值，它不和任何类型的值相等，包括它自己，同时它与任何类型的值比较大小时都返回false。</p>
<blockquote>
<p>7、 相等操作符（==）</p>
</blockquote>
<p>相等操作符会对操作值进行隐式转换后进行比较：<br>（1）如果一个操作值为布尔值，则在比较之前先将其转换为数值<br>（2）如果一个操作值为字符串，另一个操作值为数值，则通过Number()函数将字符串转换为数值<br>（3）如果一个操作值是对象（包括数组，对象所有的引用类型的值），另一个不是，则调用对象的valueOf()方法，得到的结果按照前面的规则进行比较<br>（4）null与undefined是相等的<br>（5）如果一个操作值为NaN，则相等比较返回false<br>（6）如果两个操作值都是对象，则比较它们是不是指向同一个对象</p>
<p>举例说明：</p>
<p>[1,2]+[3,4] == “1,23,4”</p>
<p>[1,2,{}] == “1,2,[object, Object]”</p>
<p>[]+[] == ‘’</p>
<p>[]+{} == ‘[object Object]’</p>
<p>{}+{} == NaN （在firefox中，javascript把第一个{}解释成空的代码块，并忽略了它，NaN其实就是+{}的计算结果，这里的+号不是二元运算符，而是一元运算符，作用是将它后面的操作数转换成数字）</p>
<p>{}+{} == “[object Object][object Object]”</p>
<p>+”3.65” == 3.65</p>
<p>++[[]][+[]]+[+[]] == ‘10’</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.juphy.cn/blogs/a549916c.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Juphy">
      <meta itemprop="description" content="挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="挽留之王小石">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blogs/a549916c.html" class="post-title-link" itemprop="url">nodejs文件路径问题</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-28 11:22:00" itemprop="dateCreated datePublished" datetime="2018-08-28T11:22:00+08:00">2018-08-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-08-30 17:45:56" itemprop="dateModified" datetime="2018-08-30T17:45:56+08:00">2018-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index">
                    <span itemprop="name">node</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="process-cwd"><a href="#process-cwd" class="headerlink" title="process.cwd()"></a>process.cwd()</h2><p>获取node命令启动路径，其值与代码所在位置无关，即<code>运行node命令时所在的文件夹的绝对路径</code>。</p>
<p>File System模块使用相对路径读写文件时，参考的就是这个路径。适用于开发命令行程序时，读取命令启动位置目录的文件。</p>
<h2 id="dirname"><a href="#dirname" class="headerlink" title="__dirname"></a>__dirname</h2><p>被执行的js所在的文件夹的绝对路径</p>
<h2 id="filename"><a href="#filename" class="headerlink" title="__filename"></a>__filename</h2><p>被执行的js的绝对路径</p>
<h2 id="require"><a href="#require" class="headerlink" title="require()"></a>require()</h2><p>只有在require时才使用相对路径(./，../)的引用方法。require的使用效果是跟__dirname的效果相同，不会因为启动脚本的目录不一样而改变。</p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">G://</span><br><span class="line">- angular/</span><br><span class="line">    - server/</span><br><span class="line">        - main.js</span><br><span class="line">        - api.js</span><br><span class="line">    - spider/</span><br><span class="line">        - mono.js</span><br><span class="line">        - one.js     </span><br><span class="line"></span><br><span class="line">运行代码：</span><br><span class="line">var path = require(&apos;path&apos;);</span><br><span class="line">console.log(__dirname);</span><br><span class="line">console.log(__filename);</span><br><span class="line">console.log(process.cwd());</span><br><span class="line">console.log(path.resolve(&apos;./&apos;));</span><br></pre></td></tr></table></figure>
<p>以下结果都是运行main.js所得：</p>
<ul>
<li><p>在server文件夹下，输出结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">G:\angular\server</span><br><span class="line">G:\angular\server\main.js</span><br><span class="line">G:\angular\server</span><br><span class="line">G:\angular\server</span><br></pre></td></tr></table></figure></li>
<li><p>在angular文件下，输出结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">G:\angular\server</span><br><span class="line">G:\angular\server\main.js</span><br><span class="line">G:\angular</span><br><span class="line">G:\angular</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取相同目录下的其他文件</p>
<ul>
<li>path.join(path.dirname(__filename) + ‘/api.js’)</li>
<li>path.resolve(__dirname + ‘/api.js’)</li>
</ul>
</li>
</ul>
<p>此时，不管是在angular文件夹下，还是server文件夹下，两者的结果都是<code>G:\angular\server\api.js</code>。</p>
<ul>
<li>获取相邻目录下的文件<ul>
<li>在windows下<code>path.resolve(__dirname , &#39;../spider/mono.js</code>，两种文件夹下运行结果一致；</li>
<li>在Linux的centos7下，两者结果不一致。angular文件夹下会报错<ul>
<li>如果在angular文件夹下，使用<code>path.resolve(path.resolve(&#39;./&#39;) + &#39;/spider/mono.js&#39;)</code>，或者<code>path.resolve(process.cwd() + &#39;/spider/mono.js&#39;)</code>；</li>
<li>如果在server文件夹下，使用<code>path.resolve(__dirname , &#39;../spider/mono.js&#39;)</code>; </li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="path-resolve和path-join的区别"><a href="#path-resolve和path-join的区别" class="headerlink" title="path.resolve和path.join的区别"></a>path.resolve和path.join的区别</h2><ul>
<li>path.join 全部给定的 path 片段连接到一起，并规范化生成的路径。如果<code>连接后的路径字符串</code>是一个长度为零的字符串，则代表返回 ‘.’，表示当前工作目录。不会对’/‘进行解读</li>
<li>path.resolve 把一个路径或路径片段的序列解析为一个绝对路径，会将’/‘当成根目录。</li>
</ul>
<p>两者都是正常解读’..’和’.’。</p>
<p>假设在G://angular；</p>
<ul>
<li>path.join(‘a’, ‘b’, ‘c’)    //  ‘a/b/c’</li>
<li>path.join(‘a’, ‘b’, ‘..’, ‘c’)      //  ‘a/c’</li>
<li>path.resolve(‘a’, ‘b’, ‘..’, ‘c’)       //  G://a/c</li>
<li>path.resolve(‘/a’, ‘/b’, ‘..’, ‘c’)       //  G://c</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.juphy.cn/blogs/664a0ac7.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Juphy">
      <meta itemprop="description" content="挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="挽留之王小石">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blogs/664a0ac7.html" class="post-title-link" itemprop="url">python3发起http请求</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-24 11:22:00" itemprop="dateCreated datePublished" datetime="2018-08-24T11:22:00+08:00">2018-08-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-08-30 17:45:56" itemprop="dateModified" datetime="2018-08-30T17:45:56+08:00">2018-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python3/" itemprop="url" rel="index">
                    <span itemprop="name">python3</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="urllib"><a href="#urllib" class="headerlink" title="urllib"></a>urllib</h2><blockquote>
<p>python内置的标准库模块</p>
</blockquote>
<h3 id="urlopen"><a href="#urlopen" class="headerlink" title="urlopen"></a>urlopen</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line">url = &apos;https://api.github.com/users/github&apos;</span><br><span class="line">f = urllib.request.urlopen(url)</span><br><span class="line">// html或者json数据都可以解析</span><br><span class="line">print(f.read().decode(&apos;utf-8&apos;))</span><br></pre></td></tr></table></figure>
<p>利用type(f)可以查看输出响应的类型，<code>&lt;class &#39;http.client.HTTPResponse&#39;&gt;</code>，它是一个HTTPResponse类型的对象，它主要包括read()、readinto()、getheader(name)、getheaders()、fileno()等方法，以及msg、version、status、reason、debuglevel、closed等属性。</p>
<ul>
<li>调用read()方法可以得到返回的网页内容</li>
<li>调用status属性可以得到返回结果的状态码，如200代表请求成功，404代表网页未找到等</li>
<li>getheaders()响应头信息</li>
</ul>
<p><code>urlopen()</code>也可以传递参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">urllib.request.urlopen(url, data=None, [timeout, ]*, cafile=None, capath=None, cadefault=False, context=None)</span><br></pre></td></tr></table></figure>
<ul>
<li>data<br>data参数是可选的。如果要添加该参数，并且如果它是字节流编码格式的内容，即bytes类型，则需要通过bytes()方法转化。另外，如果传递了这个参数，则它的请求方式就不再是GET方式，而是POST方式。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line">import urllib.request</span><br><span class="line"> </span><br><span class="line">data = bytes(urllib.parse.urlencode(&#123;&apos;word&apos;: &apos;hello&apos;&#125;), encoding=&apos;utf8&apos;)</span><br><span class="line">response = urllib.request.urlopen(&apos;http://httpbin.org/post&apos;, data=data)</span><br><span class="line">print(response.read().decode(&apos;utf-8&apos;)) // 如果不加decode(&apos;utf-8&apos;)</span><br><span class="line"></span><br><span class="line">打印结果：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;args&quot;: &#123;&#125;,</span><br><span class="line">  &quot;data&quot;: &quot;&quot;,</span><br><span class="line">  &quot;files&quot;: &#123;&#125;,</span><br><span class="line">  &quot;form&quot;: &#123;</span><br><span class="line">    &quot;word&quot;: &quot;hello&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;headers&quot;: &#123;</span><br><span class="line">    &quot;Accept-Encoding&quot;: &quot;identity&quot;,</span><br><span class="line">    &quot;Connection&quot;: &quot;close&quot;,</span><br><span class="line">    &quot;Content-Length&quot;: &quot;10&quot;,</span><br><span class="line">    &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;,</span><br><span class="line">    &quot;Host&quot;: &quot;httpbin.org&quot;,</span><br><span class="line">    &quot;User-Agent&quot;: &quot;Python-urllib/3.6&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;json&quot;: null,</span><br><span class="line">  &quot;origin&quot;: &quot;61.148.29.62&quot;,</span><br><span class="line">  &quot;url&quot;: &quot;http://httpbin.org/post&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>传递的参数{word: ‘hello’}，它需要被转码成bytes（字节流）类型。其中转字节流采用了bytes()方法，该方法的第一个参数需要是str（字符串）类型，需要用urllib.parse模块里的urlencode()方法来将参数字典转化为字符串；第二个参数指定编码格式，这里指定为utf8。</p>
<ul>
<li>timeout<br>用于设置超时时间，单位为秒，意思就是如果请求超出了设置的这个时间，还没有得到响应，就会抛出异常。如果不指定该参数，就会使用全局默认时间。它支持HTTP、HTTPS、FTP请求。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line"> </span><br><span class="line">response = urllib.request.urlopen(&apos;http://httpbin.org/get&apos;, timeout=0.1)</span><br><span class="line">print(response.read())</span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">超时报错，服务器没有响应，于是抛出了URLError异常。该异常属于urllib.error模块，错误原因是超时。</span><br></pre></td></tr></table></figure>
<p>可以通过设置这个超时时间来控制一个网页如果长时间未响应，就跳过它的抓取。这可以利用try except语句来实现，相关代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">import urllib.request</span><br><span class="line">import urllib.error</span><br><span class="line"> </span><br><span class="line">try:</span><br><span class="line">    response = urllib.request.urlopen(&apos;http://httpbin.org/get&apos;, timeout=0.1)</span><br><span class="line">except urllib.error.URLError as e:</span><br><span class="line">    if isinstance(e.reason, socket.timeout):</span><br><span class="line">        print(&apos;TIME OUT&apos;)</span><br></pre></td></tr></table></figure>
<p><a href="https://docs.python.org/3/library/urllib.request.html" target="_blank" rel="noopener">更多urlopen的用法</a></p>
<h3 id="request"><a href="#request" class="headerlink" title="request"></a>request</h3><p>简单的请求可以使用urlopen，如果需要在请求中加入Headers等信息，就可以使用更强大的Request类来构建。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line"> </span><br><span class="line">request = urllib.request.Request(&apos;https://python.org&apos;)</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line">print(response.read().decode(&apos;utf-8&apos;))</span><br></pre></td></tr></table></figure>
<p>依然是使用urlopen发送请求，只不过参数不再是url，而是一个request类型的对象。</p>
<blockquote>
<p>class urllib.request.Request(url, data=None, headers={}, origin_req_host=None, unverifiable=False, method=None)</p>
</blockquote>
<ul>
<li>url 这是必选，其他事可选</li>
<li>data 必须是bytes（字节流）类型，如果是字典，可以先用urllib.parse模块里的urlencode()编码。</li>
<li>headers 可以在构造请求时通过headers参数直接构造，也可以通过调用请求实例的add_header()方法添加。</li>
<li>origin_req_host 指的是请求方的host名称或者IP地址。</li>
<li>unverifiable表示这个请求是否是无法验证的，默认是False，意思就是说用户没有足够权限来选择接收这个请求的结果。</li>
<li>method是一个字符串，用来指示请求使用的方法，比如GET、POST和PUT等<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from urllib import request, parse</span><br><span class="line"> </span><br><span class="line">url = &apos;http://httpbin.org/post&apos;</span><br><span class="line">headers = &#123;</span><br><span class="line">    &apos;User-Agent&apos;: &apos;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)&apos;,</span><br><span class="line">    &apos;Host&apos;: &apos;httpbin.org&apos;</span><br><span class="line">&#125;</span><br><span class="line">dict = &#123;</span><br><span class="line">    &apos;name&apos;: &apos;Germey&apos;</span><br><span class="line">&#125;</span><br><span class="line">data = bytes(parse.urlencode(dict), encoding=&apos;utf8&apos;)</span><br><span class="line">req = request.Request(url=url, data=data, headers=headers, method=&apos;POST&apos;)</span><br><span class="line">response = request.urlopen(req)</span><br><span class="line">print(response.read().decode(&apos;utf-8&apos;))</span><br><span class="line"></span><br><span class="line">url即请求URL，headers中指定了User-Agent和Host，参数data用urlencode()和bytes()方法转成字节流。另外，指定了请求方式为POST。</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>或者使用add_header()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">req = request.Request(url=url, data=data, method=&apos;POST&apos;)</span><br><span class="line">req.add_header(&apos;User-Agent&apos;, &apos;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)&apos;)</span><br></pre></td></tr></table></figure>

<h2 id="Requests"><a href="#Requests" class="headerlink" title="Requests"></a>Requests</h2><blockquote>
<p>由urllib3提供支持，Requests抽象了大量的程式化的代码，使得http请求比使用内置urllib库更简单</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 安装requests，pip install requests</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">from pprint import pprint</span><br><span class="line"></span><br><span class="line">r = requests.get(url)</span><br><span class="line">pprint(r.json())</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.juphy.cn/blogs/9a610f19.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Juphy">
      <meta itemprop="description" content="挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="挽留之王小石">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blogs/9a610f19.html" class="post-title-link" itemprop="url">Referer</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-23 16:22:00" itemprop="dateCreated datePublished" datetime="2018-08-23T16:22:00+08:00">2018-08-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-08-30 17:45:56" itemprop="dateModified" datetime="2018-08-30T17:45:56+08:00">2018-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是Referer"><a href="#什么是Referer" class="headerlink" title="什么是Referer?"></a>什么是Referer?</h2><blockquote>
<p>Referer[sic] 请求头字段允许由客户端指定资源的 URI 来自于哪一个请求地址，这对服务器有好处（应该是 “referrer” 这个字段拼错了）。Referer 请求头让服务器能够拿到请求资源的来源，可以用于分析用户的兴趣爱好、收集日志、优化缓存等等。同时也让服务器能够发现过时的和错误的链接并及时维护。</p>
</blockquote>
<p>Referer是HTTP请求header的一部分，当浏览器向web服务器发送请求的时候，头信息里包含有Referer。Request Headers中有一个Referer字段，对应的信息表示一个来源。</p>
<h2 id="Referer的作用？"><a href="#Referer的作用？" class="headerlink" title="Referer的作用？"></a>Referer的作用？</h2><ul>
<li>防盗链</li>
</ul>
<p>如果我在<code>www.a.com</code>里有一个<code>www.b.com</code>链接，那么访问<code>www.b.com</code>时，它的Request Headers中有Referer: <code>www.a.com</code>，可以利用这个来防止盗链了，比如我只允许我自己的网站访问我自己的图片服务器，那我的域名是<code>www.a.com</code>，那么图片服务器每次取到Referer来判断一下是不是我自己的域名<code>www.a.com</code>，如果是就继续访问，不是就拦截。</p>
<ul>
<li>获取访问来源，统计访问流量的来源和搜索的关键词</li>
</ul>
<p>像CNZZ、百度统计等可以通过Referer统计访问流量的来源和搜索的关键词（包含在URL中）等等，方便站长们有针性对的进行推广和SEO。</p>
<h2 id="防盗链"><a href="#防盗链" class="headerlink" title="防盗链"></a>防盗链</h2><blockquote>
<p>nginx配置防盗链</p>
</blockquote>
<p>利用valid_referers指令防盗链，HTTPReferer头信息是可以通过程序来伪装生成的，所以通过Referer信息防盗链并非100%可靠，但是，它能够限制大部分的盗链。</p>
<p><code>valid_referers  [none|blocked|server_names]</code><br>默认值：none 使用环境：server，location 该指令会根据Referer Header头的内容分配一个值为0或1给变量$invalid_referer。</p>
<p>该指令的参数的值：</p>
<ul>
<li>none：表示无Referer值</li>
<li>blocked：表示Referer值被防火墙进行伪装</li>
<li>server_names：表示一个或者多个主机名称</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location ~*\.(gif|jpg|png)$ &#123;</span><br><span class="line">    root /home/www/spider/;</span><br><span class="line">    valid_referers *.juphy.cn;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">        rewrite ^/soso.com // 当没有referer进行访问时，会自动跳转到这个链接。</span><br><span class="line">        return 403;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于nginx.conf的配置，if判断注意保持空格。</p>
<h2 id="反盗链"><a href="#反盗链" class="headerlink" title="反盗链"></a>反盗链</h2><ul>
<li>通过nodejs设置referer<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let http = require(&apos;http&apos;);</span><br><span class="line">let option = &#123;</span><br><span class="line">    hostname: &apos;img.juphy.cn&apos;,</span><br><span class="line">    path: &apos;/mono/images/2018-8-22.jpg&apos;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">http.get(option, res =&gt; &#123;</span><br><span class="line">    let imgdata = &apos;&apos;;</span><br><span class="line">    res.on(&apos;data&apos;, chunk =&gt; &#123;</span><br><span class="line">        imgdata += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.on(&apos;end&apos;, () =&gt; &#123;</span><br><span class="line">        console.log(imgdata);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.juphy.cn/blogs/9b757592.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Juphy">
      <meta itemprop="description" content="挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="挽留之王小石">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blogs/9b757592.html" class="post-title-link" itemprop="url">nodejs发起http请求</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-23 11:22:00" itemprop="dateCreated datePublished" datetime="2018-08-23T11:22:00+08:00">2018-08-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-09-10 17:25:57" itemprop="dateModified" datetime="2018-09-10T17:25:57+08:00">2018-09-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index">
                    <span itemprop="name">node</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>【原文】<a href="https://www.twilio.com/blog/2017/08/http-requests-in-node-js.html" target="_blank" rel="noopener">5 Ways to Make HTTP Requests in Node.js</a></p>
<h2 id="HTTP模块，http或者https库-需要解析JSON格式"><a href="#HTTP模块，http或者https库-需要解析JSON格式" class="headerlink" title="HTTP模块，http或者https库 需要解析JSON格式"></a>HTTP模块，http或者https库 需要解析JSON格式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const https = require(&apos;https&apos;);</span><br><span class="line">https.get(&apos;https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&apos;, res =&gt; &#123;</span><br><span class="line">    let data = &apos;&apos;;</span><br><span class="line">    res.on(&apos;data&apos;, chunk =&gt; &#123;</span><br><span class="line">        data += chunk;</span><br><span class="line">    &#125;)</span><br><span class="line">    res.on(&apos;end&apos;, () =&gt; &#123;</span><br><span class="line">        console.log(1, JSON.parse(data))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).on(&apos;error&apos;, err =&gt; &#123;</span><br><span class="line">    console.log(&apos;Error：&apos; + err.message);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="request库，如果使用promise可以调用request-promise库"><a href="#request库，如果使用promise可以调用request-promise库" class="headerlink" title="request库，如果使用promise可以调用request-promise库"></a>request库，如果使用promise可以调用request-promise库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const request = require(&apos;request&apos;);</span><br><span class="line">request(&apos;https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&apos;, &#123;json: true&#125;, (err, res, body) =&gt; &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        return console.log(err)</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(2, body);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="request-promise库-request的promise操作"><a href="#request-promise库-request的promise操作" class="headerlink" title="request-promise库 request的promise操作"></a>request-promise库 request的promise操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const requestPromise = require(&apos;request-promise&apos;);</span><br><span class="line">requestPromise(&apos;https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&apos;)</span><br><span class="line">    .then(res =&gt; &#123;</span><br><span class="line">        console.log(3, res);</span><br><span class="line">    &#125;).catch(err =&gt; &#123;</span><br><span class="line">    console.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h2><p>Axios是一个基于promise的HTTP客户端，可以用于浏览器和Node.js</p>
<h3 id="axios库-默认情况下，Axios可以解析JSON响应"><a href="#axios库-默认情况下，Axios可以解析JSON响应" class="headerlink" title="axios库 默认情况下，Axios可以解析JSON响应"></a>axios库 默认情况下，Axios可以解析JSON响应</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const axios = require(&apos;axios&apos;);</span><br><span class="line">axios.get(&apos;https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&apos;)</span><br><span class="line">    .then(res =&gt; &#123;</span><br><span class="line">        console.log(4, res.data);</span><br><span class="line">    &#125;).catch(err =&gt; &#123;</span><br><span class="line">    console.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="axios库的all，发起并发请求"><a href="#axios库的all，发起并发请求" class="headerlink" title="axios库的all，发起并发请求"></a>axios库的all，发起并发请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">axios.all([</span><br><span class="line">    axios.get(&apos;https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&amp;date=2017-08-03&apos;),</span><br><span class="line">    axios.get(&apos;https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&amp;date=2017-08-02&apos;),</span><br><span class="line">]).then(axios.spread((res1, res2) =&gt; &#123;</span><br><span class="line">    console.log(&apos;res1&apos;, res1.data);</span><br><span class="line">    console.log(&apos;res2&apos;, res2.data);</span><br><span class="line">&#125;)).catch(err =&gt; &#123;</span><br><span class="line">    console.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="superAgent-默认解析JSON响应，能进行链式调用"><a href="#superAgent-默认解析JSON响应，能进行链式调用" class="headerlink" title="superAgent 默认解析JSON响应，能进行链式调用"></a>superAgent 默认解析JSON响应，能进行链式调用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const superagent = require(&apos;superagent&apos;);</span><br><span class="line">superagent.get(&apos;https://api.nasa.gov/planetary/apod&apos;)</span><br><span class="line">    .query(&#123;api_key: &apos;DEMO_KEY&apos;, date: &apos;2017-08-02&apos;&#125;)</span><br><span class="line">    .end((err, res) =&gt; &#123;</span><br><span class="line">        if (err) &#123;</span><br><span class="line">            return console.log(err)</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(5, res.body);</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Got-类似于promise，比较轻量，不像request那样臃肿"><a href="#Got-类似于promise，比较轻量，不像request那样臃肿" class="headerlink" title="Got 类似于promise，比较轻量，不像request那样臃肿"></a>Got 类似于promise，比较轻量，不像request那样臃肿</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const got = require(&apos;got&apos;);</span><br><span class="line">got(&apos;https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&apos;, &#123;json: true&#125;)</span><br><span class="line">    .then(res =&gt; &#123;</span><br><span class="line">        console.log(res.body);</span><br><span class="line">    &#125;).catch(err =&gt; &#123;</span><br><span class="line">    console.log(err.reponse.body);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="node-fetch库与window-fetch-API保持一致"><a href="#node-fetch库与window-fetch-API保持一致" class="headerlink" title="node-fetch库与window.fetch API保持一致"></a>node-fetch库与window.fetch API保持一致</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">const fetch = require(&apos;node-fetch&apos;);</span><br><span class="line"></span><br><span class="line">*plain text or html</span><br><span class="line"></span><br><span class="line">fetch(&apos;https://github.com/&apos;)</span><br><span class="line">    .then(res =&gt; res.text())</span><br><span class="line">    .then(body =&gt; console.log(body));</span><br><span class="line"></span><br><span class="line">*json</span><br><span class="line"></span><br><span class="line">fetch(&apos;https://api.github.com/users/github&apos;)</span><br><span class="line">    .then(res =&gt; res.json())</span><br><span class="line">    .then(json =&gt; console.log(json));</span><br><span class="line"></span><br><span class="line">*catch network error</span><br><span class="line"></span><br><span class="line">fetch(&apos;http://domain.invalid/&apos;)</span><br><span class="line">    .catch(err =&gt; console.error(err));</span><br><span class="line"></span><br><span class="line">*stream</span><br><span class="line"></span><br><span class="line">fetch(&apos;https://assets-cdn.github.com/images/modules/logos_page/Octocat.png&apos;)</span><br><span class="line">    .then(res =&gt; &#123;</span><br><span class="line">        return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">            const dest = fs.createWriteStream(&apos;./octocat.png&apos;);</span><br><span class="line">            res.body.pipe(dest);</span><br><span class="line">            res.body.on(&apos;error&apos;, err =&gt; &#123;</span><br><span class="line">                reject(err);</span><br><span class="line">            &#125;);</span><br><span class="line">            dest.on(&apos;finish&apos;, () =&gt; &#123;</span><br><span class="line">                resolve();</span><br><span class="line">            &#125;);</span><br><span class="line">            dest.on(&apos;error&apos;, err =&gt; &#123;</span><br><span class="line">                reject(err);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p><a href="https://www.npmjs.com/package/node-fetch" target="_blank" rel="noopener">更多fetch的用法</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Juphy"
    src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Juphy</p>
  <div class="site-description" itemprop="description">挽留天涯挽留人,挽留岁月挽留你。它就是挽留,我就是使挽留的人,只看谁是要被挽留。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Juphy</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">79k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:12</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.5.0
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  

</body>
</html>
